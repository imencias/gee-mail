<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
		<script language="javascript" type="text/javascript">

		$(document).ready(function() {
			displayMail();
			autoRetrieve();

   			 $(".msgContent").hide();
		});

			function toggleThis (t) {
				$(t).next().slideToggle();
				console.log(t);
			}

		loadGeeMails();
		var inboxCount = window.geemails.length;

		function updateInboxCount() {
			document.getElementById("inboxTotal").innerHTML = "Inbox (" + inboxCount + ")";
		}

		function displayMail() {
			for(key in window.geemails){
				addMsg( window.geemails[key] );
			}
		}

		function autoRetrieve() {
			var newMsg = getNewMessage();
			inboxCount++;
			addMsg( newMsg );
			window.geemails.push( newMsg );
			setTimeout( 'autoRetrieve()', 6000 );
		}

		function addMsg( m ) {
		    var div1 = document.createElement('div');
		    div1.className = 'toggleDiv';
		    div1.onclick = function(){toggleThis( this )};
		    div1.innerHTML = '<ul class=\"msgList\"><li>' + m.date + '</li><li>' + m.sender + '</li><li>' + m.subject + '</li></ul></div>';
		    document.getElementById('main').appendChild(div1);

		    var div2 = document.createElement('div');
		    div2.className = 'msgContent';
		    div2.style.display = 'none';
		    div2.innerHTML = m.body + '</div>';
		    document.getElementById('main').appendChild(div2);

		    updateInboxCount();
		}

		</script>
	</head>
	<body>
		<div class="container" id="main">
			<div id="inboxTotal">Inbox (<span></span>)</div>
		</div>
	</body>
</html>